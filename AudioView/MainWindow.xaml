<Controls:MetroWindow 
        xmlns:UserControls="clr-namespace:AudioView.UserControls"   
        xmlns:AudioView="clr-namespace:AudioView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        mc:Ignorable="d" 
        x:Class="AudioView.MainWindow"
        Title="AudioView" 
        MinHeight="600" 
        MinWidth="800">
    <Controls:MetroWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Icons.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Controls:MetroWindow.Resources>
    <Controls:MetroWindow.Flyouts>
        <Controls:FlyoutsControl>
            <Controls:Flyout Header="New Measurement" Position="Right" Width="450" IsOpen="{Binding ShowNewFlow}">
                <UserControls:NewMeasurementControl DataContext="{Binding NewViewModel}" />
            </Controls:Flyout>
        </Controls:FlyoutsControl>
    </Controls:MetroWindow.Flyouts>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="30" />
        </Grid.RowDefinitions>

        <TabControl TabStripPlacement="Top"
			Margin="10">
            <TabItem Header="Measurements">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*" MinWidth="200" />
                        <ColumnDefinition Width="6*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <Menu Grid.Row="0"
						Grid.ColumnSpan="2"
						Margin="5"
						VerticalAlignment="Stretch"
						HorizontalAlignment="Left">
                        <MenuItem Header="New measurement" Command="{Binding NewMeasurementCommand}" IsEnabled="False" />
                        <MenuItem Header="Pop-Outs" IsEnabled="{Binding MeasurementSelected}">
                            <MenuItem Header="Live Readings" Command="{Binding NewLiveReadingsPopUp}" />
                        </MenuItem>
                        <MenuItem Header="Close measurement" IsEnabled="{Binding MeasurementSelected}" Command="{Binding CloseMeasurementCommand}"/>
                    </Menu>

                    <StackPanel Grid.Row="1" VerticalAlignment="Bottom" DataContext="{Binding SelectedMeasurement}" Visibility="{Binding ShowDetails, Converter={StaticResource BoolToVisibilityConverter}, UpdateSourceTrigger=PropertyChanged}">
                        <Label FontSize="24" FontWeight="ExtraBold" Content="{Binding Title}" />
                        <StackPanel Orientation="Horizontal">

                            <Rectangle>
                                <Rectangle.Fill>
                                    <VisualBrush Visual="{StaticResource appbar_add}" />
                                </Rectangle.Fill>
                            </Rectangle>

                            <Label FontWeight="Bold" Content="dB Limit:" />
                            <Label Margin="2,0,0,0" Content="{Binding DBLimit}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Label FontWeight="Bold" Content="Minor Interval:" />
                            <Label Margin="2,0,0,0" Content="{Binding MinorInterval}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Label FontWeight="Bold" Content="Major Interval:" />
                            <Label Margin="2,0,0,0" Content="{Binding MajorInterval}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Label FontWeight="Bold" Content="Started:" />
                            <Label Margin="2,0,0,0" Content="{Binding Started}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Label FontWeight="Bold" Content="Ip:" />
                            <Label Margin="2,0,0,0" Content="{Binding MyIp}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <Label FontWeight="Bold" Content="Port:" />
                            <Label Margin="2,0,0,0" Content="{Binding Port}" />
                        </StackPanel>
                    </StackPanel>

                    <TabControl Grid.Row="1" Grid.Column="1"
						ItemsSource="{Binding Measurements}"
						SelectedItem="{Binding SelectedMeasurement}"
                        >
                        <TabControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Title}" />
                            </DataTemplate>
                        </TabControl.ItemTemplate>

                        <TabControl.ContentTemplate>
                            <DataTemplate>
                                <UserControls:MeasurementControl DataContext="{Binding}" />
                            </DataTemplate>
                        </TabControl.ContentTemplate>
                    </TabControl>
                </Grid>
            </TabItem>
            <TabItem Header="New (Temp)">
                <UserControls:NewMeasurementControl DataContext="{Binding NewViewModel}" />
            </TabItem>
            <TabItem Header="History">
                <UserControls:HistoryControl DataContext="{Binding HistoryViewModel}" />
            </TabItem>
            <TabItem Header="Settings"/>
        </TabControl>

        <ProgressBar Grid.Row="1" Minimum="0" Maximum="1000" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Value="{Binding LagTest}" />
    </Grid>
</Controls:MetroWindow>
